---
title: Edge Worker
template: splash
hero:
  tagline: Queue worker running on top of Edge Functions and PGMQ
  image:
    file: ../../assets/nodes-group-logo.svg
  actions:
    - text: Get started
      link: '#-get-started'
      variant: primary
---

import { Aside, Steps, Badge } from "@astrojs/starlight/components";

**Edge Worker** is a task queue worker for Supabase that runs on top of Edge Functions and PGMQ.

It treats Edge Function termination due to CPU/clock limits
as an expected occurrence and includes extra measures to handle it as part of
normal operations:

- stops polling as soon as the soft limit is reached
- makes extra effort to gracefully abort pending jobs with abort signals
- uses PGMQ's visibility timeout to ensure **no job is ever lost**
- **spawns new instances** automatically for **continuous operations**
- pings db with **heartbeats** to ensure we know worker is alive

## ðŸš€ Get started

<Aside type="caution" title="Requirements">
You should have Supabase CLI installed and local project set up already.
If you don't, follow Supabase's [installation guide](https://supabase.com/docs/guides/cli) first.
</Aside>

<Steps>

1. #### Create your worker

    Call your supabase CLI as usual to create new function:

    ```typescript
    npx supabase functions new my-edge-worker
    ```

    Replace contents of generated `index.ts` with the following:

    ```typescript
    import { EdgeWorker } from "@pgflow/edge-worker";

    EdgeWorker.start(async (payload: { urlToScrape: string }) => {
      // do something with the message
      console.log('Scraping URL...', urlToScrape);
    });
    ```

2. #### Update your schema

    Run the following bash script to download the migration file to your project.
    Replace `<supabase-dir>` with the path to your `supabase/` directory.

    ```bash
    wget -O <supabase-dir>/migrations/ https://raw.githubusercontent.com/pgflow-dev/pgflow/main/edge-worker/migrations/edge-worker.sql
    ```

    Then migrate, as usual:

    ```bash
    npx supabase migration up
    ```

3. #### Start your worker

    You can start worker by making an http request to its edge function:

    ```bash
    curl http://localhost:54321/functions/v1/my-edge-worker
    ```

4. #### Process your first message

    Worker by default polls for messages on PGMQ queue named `default` (configurable).

    You just need to send a message to that queue:

    ```sql
    SELECT pgmq.send('default', '{"urlToScrape": "https://example.com"}'::jsonb);
    ```

    Worker will start processing the message immediately.

    <Aside title="Queues">
      If you do not create the queue yourself, the worker will create
      a logged, non-partitioned queue for you during startup.
    </Aside>

</Steps>
